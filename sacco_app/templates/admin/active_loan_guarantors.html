{% extends "base.html" %}

{% block content %}

<h5 class="mb-3">Active Loan Guarantors</h5>

<form method="POST" class="card p-3 mb-4">
  <div class="row align-items-end">
    <div class="col-md-3">
      <label class="form-label">Member Number</label>
      <input type="text"
             name="member_no"
             class="form-control"
             value="{{ member_no or '' }}"
             required>
    </div>

    <div class="col-md-2">
      <button class="btn btn-primary w-100">
        View Guarantors
      </button>
    </div>
  </div>
</form>

{% if loan %}
<div class="card mb-3">
  <div class="card-body">
    <strong>Loan No:</strong> {{ loan.loan_no }} <br>
    <strong>Loan Amount:</strong> {{ "{:,.2f}".format(loan.loan_amount) }} <br>
    <strong>Outstanding Balance:</strong>
    {{ "{:,.2f}".format(loan.balance) }}
  </div>
</div>
{% endif %}

{% if guarantors %}
<div class="card">
  <div class="card-header">
    Guarantors
  </div>

  <div class="card-body p-0">
    <table class="table table-bordered mb-0">
      <thead class="table-light">
        <tr>
          <th>Guarantor No</th>
          <th>Guarantor Name</th>
		   <th>Contact</th>
          <th>Amount Guaranteed</th>
        </tr>
      </thead>
      <tbody>
        {% for g in guarantors %}
        <tr>
          <td>{{ g.guarantor_no }}</td>
          <td>{{ g.name or 'N/A' }}</td>
			<td>{{ g.phone or 'N/A' }}</td>

          <td class="text-end">
            {{ "{:,.2f}".format(g.amount_guaranteed) }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card-footer text-end fw-bold">
    Total Guaranteed:
    {{ "{:,.2f}".format(total_guaranteed) }}
  </div>
</div>

{% elif member_no %}
<div class="alert alert-warning">
  No active loan or no guarantors found for this member.
</div>
{% endif %}

{% endblock %}
